<!DOCTYPE html>
<html>
<head>
    <title>测试同步函数</title>
    <style>
        /* ... (styles remain the same) ... */
    </style>
</head>
<body>
    <h1>测试同步函数</h1>
    
    <div>
        <p>选择要同步的数据类型：</p>
        <select id="dataTypeSelector">
            <option value="pagespeed">PageSpeed</option>
            <option value="clarity">Clarity</option>
        </select>
    </div>

    <div>
        <p>PageSpeed URLs (逗号分隔):</p>
        <input type="text" id="pageUrls" value="https://vertu.com/" style="width: 500px;">
    </div>

    <div>
        <p>Clarity Project ID:</p>
        <input type="text" id="clarityProjectId" value="rgo4phzla8" style="width: 200px;">
    </div>
    
    <button onclick="callSyncFunction()">开始同步</button>
    
    <h2>响应：</h2>
    <div id="response">等待调用...</div>

    <script>
        async function callSyncFunction() {
            const syncType = document.getElementById('dataTypeSelector').value; // Use 'syncType' to be explicit
            const pageUrls = document.getElementById('pageUrls').value.split(',').map(url => url.trim());
            const clarityProjectId = document.getElementById('clarityProjectId').value;

            document.getElementById('response').textContent = '正在调用函数，请稍候...';
            
            // The parameter key MUST be 'type' to match the backend function's expectation.
            let body = { type: syncType };

            if (syncType === 'pagespeed') {
                body.pageUrls = pageUrls;
            } else if (syncType === 'clarity') {
                body.clarityProjectId = clarityProjectId;
            }

            try {
                const response = await fetch('https://rrfurkgzyliqudkjmckk.supabase.co/functions/v1/sync-external-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // It's good practice to include the anon key for RLS, even if the function uses service_role
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJyZnVya2d6eWxpcXVka2ptY2trIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI4MTk2NjQsImV4cCI6MjA2ODM5NTY2NH0.HQCqzJvEJiKK2W_ibUQbm7p2C2CwV7gUpMBegbYs0QU'
                    },
                    body: JSON.stringify(body),
                });

                const result = await response.json();
                document.getElementById('response').textContent = JSON.stringify(result, null, 2);

            } catch (error) {
                document.getElementById('response').textContent = `调用出错: ${error.message}`;
                console.error('调用错误:', error);
            }
        }
    </script>
</body>
</html> 